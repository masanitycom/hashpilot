# auth@hashpilot.biz メール移行手順書

実施予定: 深夜（会員登録が少ない時間帯）
作業時間: 5-10分
リスク: 最小

---

## 📋 事前準備チェックリスト

### 必要な情報
- [ ] auth@hashpilot.biz のSMTPホスト名
- [ ] SMTPポート番号（587 または 465）
- [ ] auth@hashpilot.biz のユーザー名（通常はメールアドレスそのまま）
- [ ] auth@hashpilot.biz のパスワード

### 確認事項
- [ ] メールプロバイダーの設定画面でSMTP情報を確認済み
- [ ] Supabaseダッシュボードのログイン情報を確認済み
- [ ] ロールバック手順を理解済み

---

## 🚀 実施手順（深夜実施）

### STEP 1: Supabaseダッシュボードにログイン
1. https://supabase.com/dashboard にアクセス
2. HASHPILOTプロジェクトを選択
3. 左メニュー → **Settings** → **Authentication**

### STEP 2: SMTP設定ページへ移動
1. **SMTP Settings** タブをクリック
2. 現在の設定を確認（スクリーンショット推奨）

### STEP 3: カスタムSMTP設定を入力

```
Enable Custom SMTP: ✅ ON

SMTP Host: [メールプロバイダーから提供されたホスト]
例: smtp.hostinger.com, mail.hashpilot.biz など

SMTP Port: [メールプロバイダーから提供されたポート]
例: 587 (TLS) または 465 (SSL)

SMTP Username: auth@hashpilot.biz

SMTP Password: [メールプロバイダーから提供されたパスワード]

Sender Email: auth@hashpilot.biz
Sender Name: HASHPILOT
```

### STEP 4: テスト送信（重要！）
1. **「Send test email」**ボタンをクリック
2. テスト送信先のメールアドレスを入力（自分のメール）
3. メールが届くか確認
4. 送信元が「auth@hashpilot.biz」になっているか確認

### STEP 5: 保存
1. テスト成功を確認後、**「Save」**ボタンをクリック
2. 「Settings saved successfully」と表示されることを確認

### STEP 6: 本番テスト
1. テスト用メールアドレスで新規登録
2. 認証メールが届くか確認
3. 送信元が「auth@hashpilot.biz」か確認
4. メール内のリンクが正常に動作するか確認

---

## ✅ 成功確認

以下が全て確認できればOK：
- [ ] テストメールが auth@hashpilot.biz から届いた
- [ ] 新規登録の認証メールが auth@hashpilot.biz から届いた
- [ ] メール内のリンクが正常に動作した
- [ ] メール本文が正しく表示された

---

## 🔄 ロールバック手順（問題発生時）

### 方法1: SMTP設定を無効化
1. Settings → Authentication → SMTP Settings
2. **「Enable Custom SMTP」をOFF**
3. Save
4. → Supabaseデフォルトメール（hashpilotnft@gmail.com経由）に戻る

### 方法2: 設定を削除
1. SMTP Settingsページ
2. 全てのフィールドをクリア
3. Save

**所要時間**: 1分以内で元に戻ります

---

## ⚠️ トラブルシューティング

### テストメールが届かない場合

#### 原因1: SMTP認証エラー
- ユーザー名・パスワードを再確認
- メールプロバイダーの管理画面で「SMTP認証」が有効か確認

#### 原因2: ポート番号の誤り
- 587 (TLS) と 465 (SSL) を両方試す
- ファイアウォールでブロックされていないか確認

#### 原因3: 「安全性の低いアプリ」設定
- メールプロバイダーで「安全性の低いアプリ」の許可が必要な場合あり
- 管理画面で設定を確認

### メールは届くが送信元が違う場合
- Sender Email が auth@hashpilot.biz になっているか確認
- メールプロバイダーが送信元の書き換えをしていないか確認

---

## 📞 緊急連絡先

問題が発生した場合：
1. まずロールバック（上記手順）
2. 既存システムは影響を受けない
3. 翌日に再調査・再実施

---

## 📝 実施後の確認事項

- [ ] 翌日、新規登録メールが正常に送信されているか確認
- [ ] system_logs テーブルでエラーがないか確認
- [ ] ユーザーから「メールが届かない」報告がないか確認

---

## ✨ 実施完了後

この手順書に実施結果を記録：

**実施日時**: _______________
**実施者**: _______________
**結果**: □ 成功 □ 失敗（ロールバック）
**備考**: _______________

---

**重要**: この設定変更は**既存システムに一切影響しません**。
SMTP設定のみの変更で、コードやデータベースは変更しません。
