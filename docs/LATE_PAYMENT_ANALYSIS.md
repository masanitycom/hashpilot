# é‹ç”¨é–‹å§‹å¾Œã®é€”ä¸­å…¥é‡‘å¯¾å¿œåˆ†æž

## ðŸ“… åˆ†æžæ—¥: 2025å¹´1æœˆ24æ—¥

## ðŸ” ç¾çŠ¶åˆ†æž

### æ—¥åˆ©è¨ˆç®—ã®å¯¾è±¡æ¡ä»¶
ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ãŒæ—¥åˆ©è¨ˆç®—ã®å¯¾è±¡ã¨ãªã‚Šã¾ã™ï¼š

1. **affiliate_cycleãƒ†ãƒ¼ãƒ–ãƒ«**: `total_nft_count > 0`
2. **åŸºæº–é‡‘é¡è¨ˆç®—**: NFTæ•° Ã— $1,100

### æœªå…¥é‡‘ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çŠ¶æ…‹
- **ç™»éŒ²æ¸ˆã¿ãƒ»æœªå…¥é‡‘**: `total_nft_count = 0`
- **æ—¥åˆ©è¨ˆç®—**: å¯¾è±¡å¤–
- **åˆ©ç›Šé…å¸ƒ**: ãªã—

## âš ï¸ é€”ä¸­å…¥é‡‘æ™‚ã®å½±éŸ¿

### ã‚·ãƒŠãƒªã‚ª: é‹ç”¨é–‹å§‹å¾Œã«æ–°è¦å…¥é‡‘ãŒç™ºç”Ÿã—ãŸå ´åˆ

#### 1. å…¥é‡‘ã‹ã‚‰æ‰¿èªã¾ã§ã®ãƒ—ãƒ­ã‚»ã‚¹
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥é‡‘ç”³è«‹ï¼ˆpayment_sentï¼‰
2. ç®¡ç†è€…ãŒå…¥é‡‘ç¢ºèª
3. approve_user_nfté–¢æ•°å®Ÿè¡Œ
4. affiliate_cycleãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
   - total_nft_count: 0 â†’ è³¼å…¥NFTæ•°
   - manual_nft_count: 0 â†’ è³¼å…¥NFTæ•°
5. æ¬¡å›žã®æ—¥åˆ©è¨ˆç®—ã‹ã‚‰å¯¾è±¡ã«å«ã¾ã‚Œã‚‹
```

#### 2. 15æ—¥ãƒ«ãƒ¼ãƒ«ã®é©ç”¨
```
æ‰¿èªæ—¥ = admin_approved_at
é‹ç”¨é–‹å§‹æ—¥ = æ‰¿èªæ—¥ + 15æ—¥
```

### ç¾åœ¨ã®ä»•çµ„ã¿ã§ã®å‹•ä½œ

âœ… **æ­£å¸¸ã«å‹•ä½œã™ã‚‹ç‚¹**ï¼š
- æ‰¿èªæ™‚ç‚¹ã§è‡ªå‹•çš„ã«affiliate_cycleãŒæ›´æ–°ã•ã‚Œã‚‹
- æ¬¡å›žã®æ—¥åˆ©è¨ˆç®—ã‹ã‚‰è‡ªå‹•çš„ã«å¯¾è±¡ã¨ãªã‚‹
- 15æ—¥ãƒ«ãƒ¼ãƒ«ã¯å€‹åˆ¥ã«è¨ˆç®—ã•ã‚Œã‚‹
- éŽåŽ»ã®æ—¥åˆ©ã¯å—ã‘å–ã‚Œãªã„ï¼ˆæ‰¿èªæ—¥ä»¥é™ã®ã¿ï¼‰

âŒ **æ½œåœ¨çš„ãªå•é¡Œç‚¹**ï¼š
- ãªã—ï¼ˆç¾åœ¨ã®ä»•çµ„ã¿ã§é©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹ï¼‰

## ðŸ“Š å½±éŸ¿ç¯„å›²

### 1. æ—¥åˆ©è¨ˆç®—ã¸ã®å½±éŸ¿
- **å³åº§ã«åæ˜ **: æ‰¿èªç¿Œæ—¥ã‹ã‚‰æ—¥åˆ©è¨ˆç®—å¯¾è±¡
- **éŽåŽ»åˆ†ã®é¡åŠ**: ãªã—
- **ãƒžãƒ¼ã‚¸ãƒ³è¨ˆç®—**: ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨åŒã˜æ¡ä»¶

### 2. ç´¹ä»‹å ±é…¬ã¸ã®å½±éŸ¿
- **ç´¹ä»‹è€…ã¸ã®åæ˜ **: æ‰¿èªæ™‚ç‚¹ã§ç´¹ä»‹è€…ã®ãƒ„ãƒªãƒ¼ã«è¿½åŠ 
- **Level 4+è¨ˆç®—**: è‡ªå‹•çš„ã«å«ã¾ã‚Œã‚‹

### 3. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
- **é‹ç”¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å€‹åˆ¥ã®15æ—¥ãƒ«ãƒ¼ãƒ«ã§è¨ˆç®—
- **åˆ©ç›Šè¡¨ç¤º**: æ‰¿èªæ—¥ä»¥é™ã®åˆ©ç›Šã®ã¿

## ðŸ’¡ æŽ¨å¥¨äº‹é …

### ç¾åœ¨ã®ä»•çµ„ã¿ã§å•é¡Œãªã„ç†ç”±

1. **è‡ªå‹•å‡¦ç†**: approve_user_nfté–¢æ•°ãŒå…¨ã¦è‡ªå‹•å‡¦ç†
2. **å…¬å¹³æ€§**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜15æ—¥ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨
3. **é€æ˜Žæ€§**: æ‰¿èªæ—¥ã‹ã‚‰åˆ©ç›Šè¨ˆç®—é–‹å§‹ãŒæ˜Žç¢º

### é‹ç”¨ä¸Šã®æ³¨æ„ç‚¹

1. **æ‰¿èªã‚¿ã‚¤ãƒŸãƒ³ã‚°**
   - å…¥é‡‘ç¢ºèªå¾Œã€é€Ÿã‚„ã‹ã«æ‰¿èªå‡¦ç†ã‚’å®Ÿè¡Œ
   - æ‰¿èªæ—¥ãŒé‹ç”¨é–‹å§‹æ—¥ã®èµ·ç‚¹ã¨ãªã‚‹ã“ã¨ã‚’èªè­˜

2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥**
   - æ‰¿èªå®Œäº†ãƒ¡ãƒ¼ãƒ«ã§15æ—¥ãƒ«ãƒ¼ãƒ«ã‚’èª¬æ˜Ž
   - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§é‹ç”¨é–‹å§‹æ—¥ã‚’è¡¨ç¤º

3. **ç®¡ç†è€…å‘ã‘ç¢ºèªäº‹é …**
   - æ‰¿èªæ™‚ã«affiliate_cycleãŒæ­£ã—ãæ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - total_nft_countãŒè³¼å…¥æ•°ã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

## ðŸ›  å®Ÿè£…æ¸ˆã¿ã®å®‰å…¨è£…ç½®

1. **RPCé–¢æ•°ã«ã‚ˆã‚‹ä¸€è²«æ€§ä¿è¨¼**
   - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
   - ã‚¨ãƒ©ãƒ¼æ™‚ã¯è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

2. **ç›£æŸ»ãƒ­ã‚°**
   - admin_logsãƒ†ãƒ¼ãƒ–ãƒ«ã«å…¨æ‰¿èªæ“ä½œã‚’è¨˜éŒ²
   - å¤‰æ›´å±¥æ­´ã®è¿½è·¡ãŒå¯èƒ½

3. **äºŒé‡ãƒã‚§ãƒƒã‚¯æ©Ÿæ§‹**
   - purchasesãƒ†ãƒ¼ãƒ–ãƒ«: admin_approved
   - usersãƒ†ãƒ¼ãƒ–ãƒ«: has_approved_nft
   - affiliate_cycleãƒ†ãƒ¼ãƒ–ãƒ«: total_nft_count

## âœ… çµè«–

**ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã¯é€”ä¸­å…¥é‡‘ã«å¯¾ã—ã¦é©åˆ‡ã«å¯¾å¿œã§ãã¦ã„ã¾ã™ã€‚**

è¿½åŠ ã®å¯¾ç­–ã¯ä¸è¦ã§ã™ãŒã€ä»¥ä¸‹ã®ç‚¹ã‚’é‹ç”¨ã§æ³¨æ„ã—ã¦ãã ã•ã„ï¼š

1. å…¥é‡‘ç¢ºèªå¾Œã®é€Ÿã‚„ã‹ãªæ‰¿èªå‡¦ç†
2. æ‰¿èªæ—¥ï¼åˆ©ç›Šè¨ˆç®—é–‹å§‹ã®èµ·ç‚¹ã§ã‚ã‚‹ã“ã¨ã®èªè­˜
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é©åˆ‡ãªæƒ…å ±æä¾›ï¼ˆ15æ—¥ãƒ«ãƒ¼ãƒ«ã®èª¬æ˜Žï¼‰

## ðŸ“ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

é€”ä¸­å…¥é‡‘ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã†å ´åˆï¼š

```sql
-- 1. æœªå…¥é‡‘ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¢ºèª
SELECT user_id, email, total_purchases
FROM users
WHERE total_purchases = 0;

-- 2. æ‰¿èªå¾Œã®affiliate_cycleç¢ºèª
SELECT user_id, total_nft_count, manual_nft_count
FROM affiliate_cycle
WHERE user_id = 'ãƒ†ã‚¹ãƒˆå¯¾è±¡USER_ID';

-- 3. æ—¥åˆ©è¨ˆç®—å¯¾è±¡ã®ç¢ºèª
SELECT COUNT(*) as target_users
FROM affiliate_cycle
WHERE total_nft_count > 0;
```